# DICOM-Viewer

## 项目简介

DICOM-Viewer 是一个基于 Python 的 DICOM（尤其是 OCT 类型）文件查看器，支持 DICOM 文件解析、三视图展示、病灶检测与分割、报告生成等功能。

## 目录结构及文件说明

### 根目录文件

1. **main.py**  
   程序入口文件，初始化主窗口并启动应用程序。通过 `DicomViewer` 类加载主界面 UI，建立信号槽连接，是程序运行的起点。

2. **Config.py**

   配置常量

3. **requirements.txt**  
   项目依赖清单，包含运行所需的第三方库：

   - `requests`：用于网络请求（如调用检测模型接口）
   - `PyQt5`：构建图形用户界面
   - `reportlab`：生成 PDF 报告
   - `numpy`：处理图像数组数据
   - `qimage2ndarray`：图像格式转换
   - `opencv-python`：图像处理（缩放、格式转换等）
   - `pydicom`：解析 DICOM 文件
   - `matplotlib`：图像显示与可视化

4. **.gitignore**  
   Git 版本控制忽略文件配置，指定无需纳入版本管理的文件/目录，包括编辑器配置（`.idea/`、`.vscode/`）、数据文件（`data/`、`temp/`）及 PDF 输出（`*.pdf`）。


### UI 目录

#### 核心界面与入口文件

1. **mainWindow.py**
   主窗口逻辑实现文件，基于 mainWindow.ui 生成的 UI 代码扩展，包含初始化界面元素、建立信号与槽连接、处理图像显示切换（如帧索引调整、极坐标视图切换）、病灶显示控制（颜色选择、显隐切换）等核心交互逻辑。
   关键功能：整合三视图（横截面、纵截面、冠状面）展示、病灶检测 / 分割结果可视化、帧索引调整（滚轮 / 滑块）、极坐标转换等功能。
2. **mainWindow.ui**
   通过 Qt Designer 设计的主窗口界面文件，定义了程序的整体布局，包括显示控制区、图像展示区、交互按钮等组件的位置和样式。

#### 对话框相关文件

1. **checkDialog.py**

   病灶检测对话框，用于批量处理 DICOM 帧图像并调用检测模型。

   + 核心逻辑：通过 `CheckThreadAll` 线程异步处理图像（转换为 PNG 临时文件），批量发送至检测模型接口，获取并返回病灶检测结果（如巨噬细胞、空腔、血栓等）。
   + 交互：结合 `progressDialog.py` 显示处理进度（图像转换、模型请求进度）。

1. **segDialog.py**

   病灶分割对话框，功能与 `checkDialog.py` 类似，专注于分割模型的调用。

   * 核心逻辑：通过 `SegThreadAll` 线程批量处理图像，调用分割模型接口，获取纤维斑块、钙化斑块等分割结果。

   * 特点：支持单帧或批量分割，通过进度条实时反馈处理状态。

3. **reportDialog.py**

   报告生成对话框，用于将检测 / 分割结果汇总为 PDF 报告。

   + 功能：整合患者信息、病灶类型、帧索引等数据，调用 `pdfUtil.py` 生成规范化报告，支持多线程处理以避免界面卡顿。

4. **searchDialog.py**

   DICOM 文件搜索与管理对话框，提供基于关键词的文件查询功能。

   * 核心功能：从后端接口获取 DICOM 文件列表，通过表格展示文件信息（病人 ID、检查机构、路径等），支持 Ctrl + 单击下载文件路径。

   * 交互：实现关键词搜索（姓名、ID 等），动态过滤表格内容。

5. **progressDialog.py**

   进度条对话框，用于展示耗时操作的进度（如检测 / 分割处理、报告生成）。

   * 功能：提供进度条和文本提示，支持动态更新进度值和状态信息（如 “正在检测...”“处理完成”）。

#### 图像显示与交互组件

1. **imageLabel.py**

   自定义图像标签组件，负责 DICOM 图像的显示与病灶标注绘制。

   * 核心功能：


     * 支持图像缩放、帧切换（滚轮事件）、极坐标视图转换。


     * 绘制检测结果（矩形框标注）和分割结果（点集标注），支持自定义颜色和显隐控制。


     * 关联滑动条和帧索引标签，同步更新显示状态。

2. **scImageLabel.py**

    `imageLabel.py` 的特定版本，用于处理沿轴某角度的纵截面图像显示序曲。

3. **checkColorWidget.py**

   病灶显示控制组件，封装了 “复选框 + 颜色选择按钮” 的组合控件。

   + 功能：为每种病灶类型（如巨噬细胞、纤维斑块）提供显隐切换和颜色自定义，通过信号与主窗口联动更新图像标注样式。

4. **imageViewer.py**

   图像查看器对话框，用于单独放大显示某一帧图像。

   + 功能：接收 `QPixmap` 或 `QLabel` 中的图像，提供独立窗口展示，支持基本的图像查看操作。

#### 文件上传与配置

1. **upload.py / upload.ui**

* `upload.ui`：文件上传对话框的界面设计文件，包含文件选择、路径显示等组件。

* `upload.py`：实现文件上传逻辑，支持选择本地 DICOM 文件并加载至程序中，为后续解析和显示做准备。

### utils 目录

工具类目录，包含各类辅助功能实现：

1. **dicomUtil.py**  

   DICOM 文件处理核心类 `Dicom`，负责解析 DICOM 文件（仅支持 OCT 类型），提取患者信息、检查信息及像素数据，提供三视图（横截面、纵截面、冠状面）提取、图像缩放、格式转换等方法。

2. **fileUtil.py**  

   文件处理工具，包含 DICOM 图像转 PNG、调用检测模型接口、在图像上绘制病灶方框等功能，用于辅助展示检测结果。

3. **pdfUtil.py** 

   PDF 报告生成工具，定义报告样式（字体、段落格式等），辅助 `reportDialog.py` 生成规范化的 PDF 报告。

4. **callModel.py** 

   模型调用工具，负责与检测/分割算法模型交互，获取病灶检测结果。

5. **polar.py** 

   极坐标转换工具，支持将图像转换为极坐标视图，用于特定角度的图像展示。


## 功能说明

1. **DICOM 解析**：支持读取 OCT 类型 DICOM 文件，提取患者信息和图像数据。
2. **多视图展示**：显示轴位面、矢状面、冠状面图像，并支持帧切换（滚轮、滑动条、输入跳转）；支持极坐标视角图像；支持沿任意角度为轴查看纵截面。
3. **病灶检测与分割**：调用算法模型检测病灶，在图像上标记并支持显示/隐藏。
4. **文件上传**：支持分片上传大文件至后端服务器，同步保留患者信息
5. **报告生成**：将检测结果汇总为 PDF 报告，包含患者信息、病灶类型及对应帧索引。

## 使用方法

1. 安装依赖：`pip install -r requirements.txt`
2. 运行程序：`python main.py`
3. 上传 DICOM 文件，查看图像与信息，调用检测模型后可生成报告。

